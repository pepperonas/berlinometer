'use client';

import React, { useState } from 'react';
import Link from 'next/link';
import { motion } from 'framer-motion';
import { useAuth } from '@/contexts/AuthContext';
import toast from 'react-hot-toast';

// Import our new components
import RadioGroup from '@/components/ui/RadioGroup';
import CheckboxGroup from '@/components/ui/CheckboxGroup';
import SliderWithValue from '@/components/ui/SliderWithValue';
import TagInput from '@/components/ui/TagInput';
import ExcludeIngredientsManager from '@/components/ui/ExcludeIngredientsManager';
import { Button } from '@/components/ui/Button';

// Import types and constants
import {
  RecipeFormData,
  DEFAULT_FORM_DATA,
  DIET_OPTIONS,
  GOAL_OPTIONS,
  MEAL_OPTIONS,
  CUISINE_OPTIONS,
  SLIDER_CONFIGS
} from '@/types/recipe-form';

const WISHES_SUGGESTIONS = [
  'Pasta', 'Pizza', 'Suppe', 'Salat', 'Thai', 'Scharf', 'Mild', 'Cremig',
  'Knusprig', 'Gegrillt', 'Gebacken', 'Schnell', 'Einfach', 'Gesund',
  'Low Carb', 'Protein-reich', 'Vegetarisch', 'Vegan', 'Glutenfrei',
  'Omas Auflauf', 'Comfort Food', 'Mediterran', 'Asiatisch'
];

export default function RecipeGeneratePage() {
  const { user } = useAuth();
  const [formData, setFormData] = useState<RecipeFormData>(DEFAULT_FORM_DATA);
  const [isGenerating, setIsGenerating] = useState(false);
  const [recipe, setRecipe] = useState(null);

  // Form field update handlers
  const updateField = <K extends keyof RecipeFormData>(
    field: K,
    value: RecipeFormData[K]
  ) => {
    setFormData(prev => ({ ...prev, [field]: value }));
  };

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    
    if (!user) {
      toast.error('Bitte melde dich an, um Rezepte zu generieren');
      return;
    }
    
    setIsGenerating(true);
    
    try {
      // Transform form data to API format
      const recipeRequest = {
        dietType: formData.dietType,
        goals: formData.goals,
        excludedIngredients: formData.excludedIngredients,
        variety: formData.variety,
        cookingTime: formData.cookingTime,
        cost: formData.cost,
        servings: formData.servings,
        wishes: formData.wishes,
        cuisine: formData.cuisine,
        mealType: formData.mealType,
        aiProvider: formData.aiProvider,
        // Legacy fields for API compatibility
        ingredients: formData.wishes, // Use wishes as ingredients
        difficulty: 'medium'
      };

      const response = await fetch('/api/recipes/generate', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        credentials: 'include',
        body: JSON.stringify(recipeRequest),
      });

      if (!response.ok) {
        const errorData = await response.json().catch(() => ({ message: 'Unbekannter Fehler' }));
        throw new Error(errorData.message || 'Fehler beim Generieren des Rezepts');
      }

      const data = await response.json();
      setRecipe(data.recipe);
      toast.success('Rezept erfolgreich generiert! üçΩÔ∏è');
      setIsGenerating(false);
    } catch (error) {
      console.error('Recipe generation error:', error);
      const errorMessage = error instanceof Error ? error.message : 'Fehler beim Generieren des Rezepts';
      toast.error(errorMessage);
      setIsGenerating(false);
    }
  };

  // Animation variants
  const containerVariants = {
    hidden: { opacity: 0 },
    visible: {
      opacity: 1,
      transition: {
        staggerChildren: 0.1
      }
    }
  };

  const itemVariants = {
    hidden: { opacity: 0, y: 20 },
    visible: {
      opacity: 1,
      y: 0,
      transition: {
        duration: 0.5
      }
    }
  };

  if (!user) {
    return (
      <div className="min-h-screen flex items-center justify-center">
        {/* Animated Background */}
        <div className="absolute inset-0 bg-gradient-to-br from-primary-950 via-background to-secondary-950" />
        <div className="absolute inset-0 bg-[radial-gradient(circle_at_20%_30%,rgba(99,102,241,0.08),transparent_60%)]" />
        <div className="absolute inset-0 bg-[radial-gradient(circle_at_80%_70%,rgba(237,112,20,0.06),transparent_60%)]" />
        
        {/* Floating Elements */}
        <div className="absolute top-20 left-10 w-2 h-2 bg-primary-400 rounded-full animate-pulse opacity-60" />
        <div className="absolute top-40 right-20 w-3 h-3 bg-secondary-400 rounded-full animate-bounce opacity-40" />
        <div className="absolute bottom-32 left-20 w-4 h-4 bg-primary-300 rounded-full animate-ping opacity-30" />
        
        <div className="relative z-10">
          <motion.div
            initial={{ opacity: 0, y: 20 }}
            animate={{ opacity: 1, y: 0 }}
            className="text-center space-y-8 max-w-md mx-auto px-6"
          >
            <div className="text-8xl mb-8 filter drop-shadow-lg animate-bounce">üç≥</div>
            
            <div className="space-y-4">
              <h1 className="text-3xl lg:text-4xl font-black bg-gradient-to-r from-primary-300 to-secondary-400 bg-clip-text text-transparent">
                Anmeldung erforderlich
              </h1>
              <p className="text-text-secondary text-lg leading-relaxed">
                Melde dich an, um personalisierte Rezepte mit KI zu generieren.
              </p>
            </div>
            
            <div className="pt-4">
              <Link href="/auth/login">
                <Button size="lg" variant="primary" className="shadow-primary px-8 py-4">
                  üöÄ Jetzt anmelden
                </Button>
              </Link>
            </div>
            
            <div className="flex items-center justify-center gap-4 text-sm text-text-tertiary mt-8">
              <div className="flex items-center gap-2">
                <span className="w-2 h-2 bg-success-500 rounded-full animate-pulse"></span>
                Kostenlos starten
              </div>
              <div className="flex items-center gap-2">
                <span className="w-2 h-2 bg-success-500 rounded-full animate-pulse"></span>
                3 Rezepte t√§glich gratis
              </div>
            </div>
          </motion.div>
        </div>
      </div>
    );
  }

  return (
    <div className="min-h-screen relative">
      {/* Modern Animated Background */}
      <div className="absolute inset-0 bg-gradient-to-br from-primary-950 via-background to-secondary-950" />
      <div className="absolute inset-0 bg-[radial-gradient(circle_at_25%_25%,rgba(99,102,241,0.08),transparent_70%)]" />
      <div className="absolute inset-0 bg-[radial-gradient(circle_at_75%_75%,rgba(237,112,20,0.06),transparent_70%)]" />
      
      {/* Subtle Pattern Overlay */}
      <div className="absolute inset-0 opacity-[0.02] bg-gradient-to-br from-white/5 to-transparent" />
      
      {/* Floating Animation Elements */}
      <div className="absolute top-32 left-10 w-3 h-3 bg-primary-400 rounded-full animate-pulse opacity-40" />
      <div className="absolute top-64 right-16 w-2 h-2 bg-secondary-400 rounded-full animate-bounce opacity-50" />
      <div className="absolute bottom-48 left-16 w-4 h-4 bg-primary-300 rounded-full animate-ping opacity-20" />
      <div className="absolute bottom-80 right-32 w-2 h-2 bg-secondary-300 rounded-full animate-pulse opacity-30" />
      
      <div className="relative z-10 max-w-5xl mx-auto px-4 sm:px-6 py-8 sm:py-12">
        <motion.div
          variants={containerVariants}
          initial="hidden"
          animate="visible"
          className="space-y-12"
        >
          {/* Modern Hero Section */}
          <motion.div
            variants={itemVariants}
            className="text-center space-y-8 mb-16"
          >
            <motion.div
              className="inline-flex items-center gap-3 bg-primary/10 text-primary border border-primary/20 px-6 py-3 rounded-full text-sm font-bold backdrop-blur-xl"
              variants={itemVariants}
              whileHover={{ scale: 1.05 }}
            >
              <span className="text-lg animate-spin">‚ö°</span>
              <span>KI-Powered Rezept Generator</span>
            </motion.div>
            
            <div className="space-y-6">
              <motion.h1 
                className="text-5xl lg:text-7xl font-black leading-tight"
                variants={itemVariants}
              >
                <span className="bg-gradient-to-r from-text-primary via-primary-200 to-secondary-400 bg-clip-text text-transparent">
                  Perfekte Rezepte
                </span>
                <br />
                <span className="bg-gradient-to-r from-secondary-400 to-primary-400 bg-clip-text text-transparent">
                  f√ºr jeden Geschmack
                </span>
                <span className="text-5xl lg:text-6xl ml-4">üé®</span>
              </motion.h1>
              
              <motion.p 
                className="text-xl lg:text-2xl text-text-secondary max-w-3xl mx-auto leading-relaxed font-light"
                variants={itemVariants}
              >
                Konfiguriere deine <span className="text-primary font-semibold">Vorlieben</span> und 
                <span className="text-secondary font-semibold"> KI-Technologie</span> erstellt 
                ma√ügeschneiderte Rezepte f√ºr dich.
              </motion.p>
            </div>
            
            {/* Quick Stats */}
            <motion.div 
              className="flex flex-wrap justify-center gap-6 pt-4"
              variants={itemVariants}
            >
              <div className="flex items-center gap-2 text-sm text-text-tertiary">
                <span className="w-2 h-2 bg-success-500 rounded-full animate-pulse"></span>
                OpenAI GPT-4 Powered
              </div>
              <div className="flex items-center gap-2 text-sm text-text-tertiary">
                <span className="w-2 h-2 bg-success-500 rounded-full animate-pulse"></span>
                Personalisierte Ern√§hrung
              </div>
              <div className="flex items-center gap-2 text-sm text-text-tertiary">
                <span className="w-2 h-2 bg-success-500 rounded-full animate-pulse"></span>
                Profi-Kochtipps inklusive
              </div>
            </motion.div>
          </motion.div>

          {/* Main Form */}
          <motion.form
            onSubmit={handleSubmit}
            variants={itemVariants}
            className="space-y-12"
          >
            {/* Form Sections */}
            <div className="space-y-16">
              {/* Ern√§hrungstyp */}
              <motion.div
                variants={itemVariants}
                className="card card-glass p-8 border border-primary/20 hover:border-primary/40 transition-all duration-500 group"
                whileHover={{ y: -4, scale: 1.01 }}
              >
                {/* Glow Effect */}
                <div className="absolute inset-0 bg-gradient-to-br from-primary/5 via-transparent to-secondary/5 rounded-2xl opacity-0 group-hover:opacity-100 transition-opacity duration-500" />
                <RadioGroup
                  name="dietType"
                  value={formData.dietType}
                  onChange={(value) => updateField('dietType', value as any)}
                  options={DIET_OPTIONS.map(opt => ({
                    value: opt.value,
                    label: opt.label,
                    icon: opt.icon,
                    description: opt.description
                  }))}
                  label="Ern√§hrungsweise"
                  description="W√§hle deine bevorzugte Ern√§hrungsform"
                  layout="horizontal"
                  size="lg"
                />
              </motion.div>

              {/* Ziele */}
              <motion.div
                variants={itemVariants}
                className="card card-glass p-8 border border-secondary/20 hover:border-secondary/40 transition-all duration-500 group"
                whileHover={{ y: -4, scale: 1.01 }}
              >
                {/* Glow Effect */}
                <div className="absolute inset-0 bg-gradient-to-br from-secondary/5 via-transparent to-primary/5 rounded-2xl opacity-0 group-hover:opacity-100 transition-opacity duration-500" />
                <CheckboxGroup
                  name="goals"
                  values={formData.goals}
                  onChange={(values) => updateField('goals', values as any)}
                  options={GOAL_OPTIONS.map(opt => ({
                    value: opt.value,
                    label: opt.label,
                    icon: opt.icon,
                    description: opt.description
                  }))}
                  label="Dein Ziel üíï"
                  description="Was m√∂chtest du mit deiner Ern√§hrung erreichen?"
                  layout="grid"
                  size="md"
                  minSelections={1}
                  maxSelections={3}
                />
              </motion.div>

              {/* Zutatenverwaltung */}
              <motion.div
                variants={itemVariants}
                className="card card-glass p-8 border border-error/20 hover:border-error/40 transition-all duration-500 group"
                whileHover={{ y: -4, scale: 1.01 }}
              >
                {/* Glow Effect */}
                <div className="absolute inset-0 bg-gradient-to-br from-error/5 via-transparent to-warning/5 rounded-2xl opacity-0 group-hover:opacity-100 transition-opacity duration-500" />
                <ExcludeIngredientsManager
                  excludedIngredients={formData.excludedIngredients}
                  onChange={(ingredients) => updateField('excludedIngredients', ingredients)}
                />
              </motion.div>

              {/* Slider-Bereich */}
              <motion.div
                variants={itemVariants}
                className="card card-glass p-8 border border-info/20 hover:border-info/40 transition-all duration-500 group"
                whileHover={{ y: -4, scale: 1.01 }}
              >
                {/* Glow Effect */}
                <div className="absolute inset-0 bg-gradient-to-br from-info/5 via-transparent to-success/5 rounded-2xl opacity-0 group-hover:opacity-100 transition-opacity duration-500" />
                <div className="relative z-10 space-y-8">
                  <div className="text-center">
                    <div className="flex items-center justify-center gap-3 mb-4">
                      <div className="w-10 h-10 bg-gradient-to-br from-info to-info-hover rounded-full flex items-center justify-center">
                        <span className="text-white text-lg">‚öôÔ∏è</span>
                      </div>
                      <h3 className="text-2xl font-bold text-text-primary">Rezept-Einstellungen</h3>
                    </div>
                    <p className="text-text-secondary">Passe deine Vorlieben an deine Bed√ºrfnisse an</p>
                  </div>
                  
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
                    {SLIDER_CONFIGS.map((config) => (
                      <SliderWithValue
                        key={config.id}
                        id={config.id}
                        label={config.label}
                        icon={config.icon}
                        value={formData[config.id]}
                        onChange={(value) => updateField(config.id, value)}
                        min={config.min}
                        max={config.max}
                        step={config.step}
                        unit={config.unit}
                        formatValue={config.formatValue}
                        minLabel={config.minLabel}
                        maxLabel={config.maxLabel}
                      />
                    ))}
                  </div>
                </div>
              </motion.div>

              {/* W√ºnsche-Feld */}
              <motion.div
                variants={itemVariants}
                className="card card-glass p-8 border border-warning/20 hover:border-warning/40 transition-all duration-500 group"
                whileHover={{ y: -4, scale: 1.01 }}
              >
                {/* Glow Effect */}
                <div className="absolute inset-0 bg-gradient-to-br from-warning/5 via-transparent to-secondary/5 rounded-2xl opacity-0 group-hover:opacity-100 transition-opacity duration-500" />
                <TagInput
                  label="Deine W√ºnsche"
                  icon="üî•"
                  value={formData.wishes}
                  onChange={(wishes) => updateField('wishes', wishes)}
                  placeholder="z. B. Pasta, Thai, scharf, oder Omas Auflauf‚Ä¶"
                  description="Beschreibe, was du dir w√ºnschst - Zutaten, Stil, Geschmack..."
                  suggestions={WISHES_SUGGESTIONS}
                  maxTags={5}
                />
              </motion.div>

              {/* L√§nderk√ºche und Mahlzeit */}
              <motion.div
                variants={itemVariants}
                className="grid grid-cols-1 lg:grid-cols-2 gap-8"
              >
                {/* L√§nderk√ºche */}
                <div className="card card-glass p-8 border border-primary/15 hover:border-primary/30 transition-all duration-300 group">
                  {/* Glow Effect */}
                  <div className="absolute inset-0 bg-gradient-to-br from-primary/3 via-transparent to-info/3 rounded-2xl opacity-0 group-hover:opacity-100 transition-opacity duration-300" />
                  <div className="space-y-4">
                    <div className="flex items-center gap-3">
                      <span className="text-2xl">üåç</span>
                      <div>
                        <h3 className="text-lg font-semibold text-gray-900">L√§nderk√ºche</h3>
                        <p className="text-sm text-gray-600">Aus welcher Region soll das Rezept stammen?</p>
                      </div>
                    </div>
                    
                    <select
                      value={formData.cuisine}
                      onChange={(e) => updateField('cuisine', e.target.value as any)}
                      className="w-full px-4 py-3 border-2 border-gray-200 rounded-2xl bg-white focus:outline-none focus:border-blue-400 focus:ring-2 focus:ring-blue-200 transition-all"
                    >
                      {CUISINE_OPTIONS.map(option => (
                        <option key={option.value} value={option.value}>
                          {option.icon} {option.label}
                        </option>
                      ))}
                    </select>
                  </div>
                </div>

                {/* Mahlzeitenauswahl */}
                <div className="card card-glass p-8 border border-secondary/15 hover:border-secondary/30 transition-all duration-300 group">
                  {/* Glow Effect */}
                  <div className="absolute inset-0 bg-gradient-to-br from-secondary/3 via-transparent to-warning/3 rounded-2xl opacity-0 group-hover:opacity-100 transition-opacity duration-300" />
                  <RadioGroup
                    name="mealType"
                    value={formData.mealType}
                    onChange={(value) => updateField('mealType', value as any)}
                    options={MEAL_OPTIONS.map(opt => ({
                      value: opt.value,
                      label: opt.label,
                      icon: opt.icon,
                      description: opt.description
                    }))}
                    label="Mahlzeit"
                    description="F√ºr welche Tageszeit?"
                    layout="vertical"
                    size="sm"
                  />
                </div>
              </motion.div>

              {/* Stunning Call-to-Action */}
              <motion.div
                variants={itemVariants}
                className="relative text-center space-y-8 py-8"
              >
                {/* Background Glow */}
                <div className="absolute inset-0 bg-gradient-to-r from-primary/20 via-secondary/20 to-primary/20 rounded-3xl blur-2xl opacity-50" />
                
                <div className="relative z-10 space-y-6">
                  <div className="space-y-4">
                    <h3 className="text-2xl lg:text-3xl font-bold bg-gradient-to-r from-primary to-secondary bg-clip-text text-transparent">
                      Bereit f√ºr dein perfektes Rezept?
                    </h3>
                    <p className="text-text-secondary max-w-md mx-auto">
                      Unsere KI erstellt in Sekunden ein ma√ügeschneidertes Rezept basierend auf deinen Einstellungen.
                    </p>
                  </div>
                  
                  <Button
                    type="submit"
                    disabled={isGenerating || formData.goals.length === 0}
                    size="xl"
                    variant="primary"
                    className="px-16 py-5 text-xl font-black shadow-primary hover:shadow-2xl transform hover:scale-105 transition-all duration-300 min-w-[300px]"
                    loading={isGenerating}
                    glow={true}
                  >
                    {isGenerating ? (
                      <span className="flex items-center gap-4">
                        <div className="w-7 h-7 border-3 border-white border-t-transparent rounded-full animate-spin" />
                        <span>KI generiert dein Rezept...</span>
                      </span>
                    ) : (
                      <span className="flex items-center gap-4">
                        <span className="text-2xl animate-pulse">üöÄ</span>
                        <span>Rezept jetzt generieren</span>
                        <span className="text-2xl animate-pulse">‚ú®</span>
                      </span>
                    )}
                  </Button>
                  
                  <div className="flex flex-col sm:flex-row items-center justify-center gap-4 text-sm text-text-tertiary">
                    <div className="flex items-center gap-2">
                      <span className="w-2 h-2 bg-success-500 rounded-full animate-pulse"></span>
                      <span>Powered by OpenAI GPT-4</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <span className="w-2 h-2 bg-success-500 rounded-full animate-pulse"></span>
                      <span>100% personalisiert</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <span className="w-2 h-2 bg-success-500 rounded-full animate-pulse"></span>
                      <span>Mit Profi-Tipps</span>
                    </div>
                  </div>
                </div>
              </motion.div>
            </div>
          </motion.form>

          {/* Spectacular Recipe Result */}
          {recipe && (
            <motion.div 
              initial={{ opacity: 0, y: 40 }}
              animate={{ opacity: 1, y: 0 }}
              transition={{ duration: 0.8, ease: "easeOut" }}
              className="mt-16 space-y-16"
            >
              {/* Epic Recipe Header */}
              <div className="relative card card-glow p-12 shadow-2xl border border-primary/30 bg-gradient-to-br from-surface via-surface-secondary to-surface-tertiary overflow-hidden">
                {/* Animated Background Elements */}
                <div className="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-primary via-secondary to-primary animate-pulse" />
                <div className="absolute inset-0 bg-gradient-to-br from-primary/3 via-transparent to-secondary/3 opacity-50" />
                <div className="absolute -top-24 -right-24 w-48 h-48 bg-primary/10 rounded-full blur-3xl animate-pulse" />
                <div className="absolute -bottom-24 -left-24 w-48 h-48 bg-secondary/10 rounded-full blur-3xl animate-pulse" />
                <div className="relative z-10 text-center mb-12">
                  {/* Success Animation */}
                  <motion.div 
                    initial={{ scale: 0 }}
                    animate={{ scale: 1 }}
                    transition={{ delay: 0.2, type: "spring", stiffness: 200 }}
                    className="inline-flex items-center gap-3 bg-gradient-to-r from-success/20 to-primary/20 text-success border border-success/30 px-6 py-3 rounded-full text-sm font-bold mb-8 backdrop-blur-xl"
                  >
                    <span className="text-lg animate-bounce">üéâ</span>
                    <span>Generierung erfolgreich ‚Ä¢ {recipe.category || 'Hauptgericht'}</span>
                    <span className="text-lg animate-bounce">‚ú®</span>
                  </motion.div>
                  
                  <motion.h2 
                    initial={{ opacity: 0, y: 20 }}
                    animate={{ opacity: 1, y: 0 }}
                    transition={{ delay: 0.4 }}
                    className="text-5xl lg:text-7xl font-black text-text-primary mb-8 leading-tight"
                  >
                    <span className="bg-gradient-to-r from-primary via-secondary to-primary bg-clip-text text-transparent">
                      {recipe.title}
                    </span>
                  </motion.h2>
                  
                  <motion.div 
                    initial={{ scaleX: 0 }}
                    animate={{ scaleX: 1 }}
                    transition={{ delay: 0.6, duration: 0.8 }}
                    className="w-32 h-1.5 bg-gradient-to-r from-primary via-secondary to-primary mx-auto mb-8 rounded-full shadow-lg"
                  />
                  
                  <motion.p 
                    initial={{ opacity: 0 }}
                    animate={{ opacity: 1 }}
                    transition={{ delay: 0.8 }}
                    className="text-text-secondary text-xl lg:text-2xl leading-relaxed max-w-4xl mx-auto font-light"
                  >
                    {recipe.description}
                  </motion.p>
                </div>
                
                {/* Animated Recipe Stats */}
                <motion.div 
                  className="relative z-10 grid grid-cols-2 lg:grid-cols-4 gap-8 mt-12"
                  initial={{ opacity: 0, y: 20 }}
                  animate={{ opacity: 1, y: 0 }}
                  transition={{ delay: 1, staggerChildren: 0.1 }}
                >
                  <motion.div 
                    className="group card card-glass p-8 text-center border border-primary/20 hover:border-primary/40 hover:shadow-primary/20 hover:shadow-2xl transform hover:scale-105 transition-all duration-500"
                    whileHover={{ y: -8 }}
                  >
                    <div className="text-4xl mb-4 group-hover:scale-110 transition-transform duration-300">üë•</div>
                    <div className="text-sm text-text-tertiary font-semibold mb-2 uppercase tracking-wider">Portionen</div>
                    <div className="text-3xl font-black text-primary">{recipe.servings}</div>
                  </motion.div>
                  
                  <motion.div 
                    className="group card card-glass p-8 text-center border border-secondary/20 hover:border-secondary/40 hover:shadow-secondary/20 hover:shadow-2xl transform hover:scale-105 transition-all duration-500"
                    whileHover={{ y: -8 }}
                  >
                    <div className="text-4xl mb-4 group-hover:scale-110 transition-transform duration-300">‚è±Ô∏è</div>
                    <div className="text-sm text-text-tertiary font-semibold mb-2 uppercase tracking-wider">Zubereitungszeit</div>
                    <div className="text-3xl font-black text-secondary">{recipe.preparationTime}</div>
                  </motion.div>
                  
                  <motion.div 
                    className="group card card-glass p-8 text-center border border-info/20 hover:border-info/40 hover:shadow-info/20 hover:shadow-2xl transform hover:scale-105 transition-all duration-500"
                    whileHover={{ y: -8 }}
                  >
                    <div className="text-4xl mb-4 group-hover:scale-110 transition-transform duration-300">üìä</div>
                    <div className="text-sm text-text-tertiary font-semibold mb-2 uppercase tracking-wider">Schwierigkeit</div>
                    <div className="text-3xl font-black text-info capitalize">{recipe.difficulty}</div>
                  </motion.div>
                  
                  <motion.div 
                    className="group card card-glass p-8 text-center border border-warning/20 hover:border-warning/40 hover:shadow-warning/20 hover:shadow-2xl transform hover:scale-105 transition-all duration-500"
                    whileHover={{ y: -8 }}
                  >
                    <div className="text-4xl mb-4 group-hover:scale-110 transition-transform duration-300">üî•</div>
                    <div className="text-sm text-text-tertiary font-semibold mb-2 uppercase tracking-wider">Kalorien</div>
                    <div className="text-3xl font-black text-warning">{recipe.nutritionalInfo?.calories || 'N/A'}</div>
                  </motion.div>
                </motion.div>
              </div>

              {/* Enhanced Ingredients Section */}
              <motion.div 
                initial={{ opacity: 0, x: -40 }}
                animate={{ opacity: 1, x: 0 }}
                transition={{ delay: 1.2, duration: 0.6 }}
                className="card card-elevated p-10 shadow-2xl border border-primary/20 hover:border-primary/30 transition-all duration-500 group"
              >
                {/* Background Gradient */}
                <div className="absolute inset-0 bg-gradient-to-br from-primary/3 via-transparent to-secondary/3 rounded-2xl opacity-0 group-hover:opacity-100 transition-opacity duration-500" />
                <div className="relative z-10 mb-10">
                  <div className="flex items-center gap-5 mb-4">
                    <div className="w-14 h-14 bg-gradient-to-br from-primary to-primary-hover rounded-2xl flex items-center justify-center shadow-lg group-hover:scale-110 transition-transform duration-300">
                      <span className="text-white text-2xl">üõí</span>
                    </div>
                    <div>
                      <h3 className="text-3xl font-black text-text-primary">Einkaufsliste</h3>
                      <p className="text-text-secondary text-lg">F√ºr {recipe.servings} k√∂stliche Portionen</p>
                    </div>
                  </div>
                </div>
                
                <div className="space-y-4">
                  {recipe.ingredients && recipe.ingredients.length > 0 ? (
                    recipe.ingredients.map((ingredient, index) => (
                      <div key={index} className="group relative mb-4">
                        <div className="flex items-center justify-between p-6 bg-gradient-to-r from-surface-variant/10 to-surface-variant/5 rounded-xl border border-outline/10 hover:border-primary/20 hover:shadow-md transition-all duration-300">
                          <div className="flex items-center gap-4">
                            <div className="w-3 h-3 bg-gradient-to-br from-primary to-secondary rounded-full flex-shrink-0 group-hover:scale-110 transition-transform"></div>
                            <div>
                              <span className="font-semibold text-on-surface text-lg leading-tight">
                                {ingredient.name}
                              </span>
                              {ingredient.preparation && (
                                <div className="text-on-surface-variant text-sm mt-1 italic">
                                  {ingredient.preparation}
                                </div>
                              )}
                              {ingredient.category && (
                                <div className="inline-flex items-center gap-1 bg-primary/10 text-primary px-2 py-0.5 rounded-full text-xs font-medium mt-2">
                                  {ingredient.category}
                                </div>
                              )}
                            </div>
                          </div>
                          <div className="text-right">
                            <div className="text-primary font-bold text-lg">
                              {ingredient.amount}
                            </div>
                            <div className="text-on-surface-variant text-sm font-medium">
                              {ingredient.unit}
                            </div>
                          </div>
                        </div>
                      </div>
                    ))
                  ) : (
                    <div className="text-center py-12">
                      <div className="text-4xl mb-4">üìù</div>
                      <p className="text-on-surface-variant text-lg">Keine Zutaten verf√ºgbar</p>
                    </div>
                  )}
                </div>
              </div>

              {/* Enhanced Instructions Section */}
              <motion.div
                initial={{ opacity: 0, x: 40 }}
                animate={{ opacity: 1, x: 0 }}
                transition={{ delay: 1.4, duration: 0.6 }}
                className="card card-elevated p-10 shadow-2xl border border-secondary/20 hover:border-secondary/30 transition-all duration-500 group"
              >
                <div className="absolute inset-0 bg-gradient-to-br from-secondary/3 via-transparent to-primary/3 rounded-2xl opacity-0 group-hover:opacity-100 transition-opacity duration-500" />
                <div className="relative z-10 mb-10">
                  <div className="flex items-center gap-5 mb-4">
                    <div className="w-14 h-14 bg-gradient-to-br from-secondary to-secondary-hover rounded-2xl flex items-center justify-center shadow-lg group-hover:scale-110 transition-transform duration-300">
                      <span className="text-white text-2xl">üë®‚Äçüç≥</span>
                    </div>
                    <div>
                      <h3 className="text-3xl font-black text-text-primary">Schritt-f√ºr-Schritt Anleitung</h3>
                      <p className="text-text-secondary text-lg">Folge dieser Anleitung f√ºr perfekte Ergebnisse</p>
                    </div>
                  </div>
                </div>
                
                <div className="space-y-6">
                  {Array.isArray(recipe.instructions) && recipe.instructions.length > 0 ? (
                    recipe.instructions.map((step, index) => (
                      <div key={index} className="group relative">
                        <div className="flex gap-5 items-start p-8 bg-gradient-to-r from-surface-variant/8 to-surface-variant/4 rounded-xl border border-outline/8 hover:border-secondary/20 hover:shadow-lg transition-all duration-300">
                          <div className="flex-shrink-0">
                            <div className="w-12 h-12 bg-gradient-to-br from-secondary to-secondary-dark text-white rounded-full flex items-center justify-center text-lg font-bold shadow-md group-hover:scale-105 transition-transform">
                              {index + 1}
                            </div>
                          </div>
                          <div className="flex-1 pt-2">
                            <p className="text-on-surface leading-relaxed text-lg font-medium">{step}</p>
                          </div>
                        </div>
                        {/* Connection line to next step */}
                        {index < recipe.instructions.length - 1 && (
                          <div className="w-0.5 h-4 bg-gradient-to-b from-secondary/40 to-transparent ml-6 mt-2"></div>
                        )}
                      </div>
                    ))
                  ) : (
                    <div className="text-center py-12">
                      <div className="text-4xl mb-4">üìã</div>
                      <p className="text-on-surface-variant text-lg">Keine Anweisungen verf√ºgbar</p>
                    </div>
                  )}
                </div>
              </div>

              {/* Cooking Tips */}
              {recipe.cookingTips && (
                <div className="card p-8 shadow-lg bg-gradient-to-br from-primary/8 to-primary/3 border border-primary/30">
                  <div className="mb-6">
                    <div className="flex items-center gap-4 mb-2">
                      <div className="w-10 h-10 bg-gradient-to-br from-primary to-primary-dark rounded-full flex items-center justify-center">
                        <span className="text-white text-lg">üí°</span>
                      </div>
                      <h3 className="text-2xl font-bold text-primary">Profi-Tipps</h3>
                    </div>
                    <p className="text-primary/80 ml-14 text-sm">F√ºr perfekte Ergebnisse</p>
                  </div>
                  <div className="p-6 bg-white/50 dark:bg-surface/30 rounded-xl border border-primary/20">
                    <p className="text-on-surface leading-relaxed text-lg font-medium">{recipe.cookingTips}</p>
                  </div>
                </div>
              )}

              {/* Serving Tips */}
              {recipe.servingTips && (
                <div className="card p-8 shadow-lg bg-gradient-to-br from-success/8 to-success/3 border border-success/30">
                  <div className="mb-6">
                    <div className="flex items-center gap-4 mb-2">
                      <div className="w-10 h-10 bg-gradient-to-br from-success to-success-dark rounded-full flex items-center justify-center">
                        <span className="text-white text-lg">üçΩÔ∏è</span>
                      </div>
                      <h3 className="text-2xl font-bold text-success">Serviervorschlag</h3>
                    </div>
                    <p className="text-success/80 ml-14 text-sm">So wird&apos;s perfekt pr√§sentiert</p>
                  </div>
                  <div className="p-6 bg-white/50 dark:bg-surface/30 rounded-xl border border-success/20">
                    <p className="text-on-surface leading-relaxed text-lg font-medium">{recipe.servingTips}</p>
                  </div>
                </div>
              )}

              {/* Nutritional Info */}
              {recipe.nutritionalInfo && (
                <div className="card p-8 shadow-lg border border-outline/20">
                  <div className="mb-8">
                    <div className="flex items-center gap-4 mb-2">
                      <div className="w-10 h-10 bg-gradient-to-br from-info to-info-dark rounded-full flex items-center justify-center">
                        <span className="text-white text-lg">üìà</span>
                      </div>
                      <h3 className="text-2xl font-bold text-on-surface">N√§hrwerte pro Portion</h3>
                    </div>
                    <p className="text-on-surface-variant ml-14">Detaillierte N√§hrwertangaben</p>
                  </div>
                  
                  <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4">
                    <div className="text-center p-6 bg-gradient-to-br from-surface-variant/15 to-surface-variant/5 rounded-2xl border border-outline/10 hover:border-primary/20 hover:shadow-md transition-all duration-300">
                      <div className="text-3xl font-bold text-primary mb-2">{recipe.nutritionalInfo.calories}</div>
                      <div className="text-sm text-on-surface-variant font-medium">kcal</div>
                    </div>
                    <div className="text-center p-6 bg-gradient-to-br from-surface-variant/15 to-surface-variant/5 rounded-2xl border border-outline/10 hover:border-secondary/20 hover:shadow-md transition-all duration-300">
                      <div className="text-3xl font-bold text-secondary mb-2">{recipe.nutritionalInfo.protein}g</div>
                      <div className="text-sm text-on-surface-variant font-medium">Protein</div>
                    </div>
                    <div className="text-center p-6 bg-gradient-to-br from-surface-variant/15 to-surface-variant/5 rounded-2xl border border-outline/10 hover:border-success/20 hover:shadow-md transition-all duration-300">
                      <div className="text-3xl font-bold text-success mb-2">{recipe.nutritionalInfo.carbs}g</div>
                      <div className="text-sm text-on-surface-variant font-medium">Kohlenhydrate</div>
                    </div>
                    <div className="text-center p-6 bg-gradient-to-br from-surface-variant/15 to-surface-variant/5 rounded-2xl border border-outline/10 hover:border-warning/20 hover:shadow-md transition-all duration-300">
                      <div className="text-3xl font-bold text-warning mb-2">{recipe.nutritionalInfo.fat}g</div>
                      <div className="text-sm text-on-surface-variant font-medium">Fett</div>
                    </div>
                    {recipe.nutritionalInfo.fiber && (
                      <div className="text-center p-6 bg-gradient-to-br from-surface-variant/15 to-surface-variant/5 rounded-2xl border border-outline/10 hover:border-info/20 hover:shadow-md transition-all duration-300">
                        <div className="text-3xl font-bold text-info mb-2">{recipe.nutritionalInfo.fiber}g</div>
                        <div className="text-sm text-on-surface-variant font-medium">Ballaststoffe</div>
                      </div>
                    )}
                  </div>
                </div>
              )}

              {/* Spectacular Action Section */}
              <motion.div 
                initial={{ opacity: 0, y: 40 }}
                animate={{ opacity: 1, y: 0 }}
                transition={{ delay: 1.8, duration: 0.6 }}
                className="relative card card-glow p-10 text-center bg-gradient-to-br from-success/8 via-primary/5 to-secondary/8 border border-success/30 overflow-hidden"
              >
                {/* Animated Background Elements */}
                <div className="absolute inset-0 bg-gradient-to-r from-success/10 via-primary/10 to-secondary/10 animate-pulse" />
                <div className="absolute -top-20 -left-20 w-40 h-40 bg-success/20 rounded-full blur-3xl animate-pulse" />
                <div className="absolute -bottom-20 -right-20 w-40 h-40 bg-primary/20 rounded-full blur-3xl animate-pulse" />
                
                <div className="relative z-10 space-y-8">
                  <motion.div
                    initial={{ scale: 0 }}
                    animate={{ scale: 1 }}
                    transition={{ delay: 2, type: "spring", stiffness: 200 }}
                    className="inline-flex items-center gap-3 bg-success/20 text-success border border-success/30 px-6 py-3 rounded-full text-sm font-bold backdrop-blur-xl"
                  >
                    <span className="text-lg animate-spin">‚ú®</span>
                    <span>Powered by OpenAI GPT-4 ‚Ä¢ Personalisiert f√ºr dich</span>
                    <span className="text-lg animate-spin">‚ö°</span>
                  </motion.div>
                  
                  <div className="space-y-4">
                    <h3 className="text-2xl font-bold bg-gradient-to-r from-success to-primary bg-clip-text text-transparent">
                      Guten Appetit! üçΩÔ∏è
                    </h3>
                    <p className="text-text-secondary max-w-md mx-auto">
                      Dein individuelles Rezept wurde erfolgreich generiert. Jetzt kann das Kochen beginnen!
                    </p>
                  </div>
                  
                  <div className="flex flex-col sm:flex-row gap-4 justify-center">
                    <Button 
                      onClick={() => setRecipe(null)} 
                      variant="primary"
                      size="lg"
                      className="px-8 py-4 shadow-primary hover:shadow-2xl transform hover:scale-105"
                    >
                      <span className="flex items-center gap-3">
                        <span className="text-xl">üîÑ</span>
                        <span>Neues Rezept generieren</span>
                      </span>
                    </Button>
                    <Link href="/recipes">
                      <Button 
                        variant="outline" 
                        size="lg"
                        className="px-8 py-4 hover:shadow-lg transform hover:scale-105"
                      >
                        <span className="flex items-center gap-3">
                          <span className="text-xl">üìö</span>
                          <span>Alle Rezepte anzeigen</span>
                        </span>
                      </Button>
                    </Link>
                  </div>
                </div>
              </motion.div>
            </motion.div>
          )}
        </motion.div>
      </div>
    </div>
  );
}