/**
 * KiezForm Modal Components
 * Version 1.0 - Unified modal system using design tokens
 * 
 * Import design-tokens.css before this file.
 * Provides consistent, accessible, and mobile-friendly modal components.
 */

/* === BASE MODAL STYLES === */

/* Modal backdrop/overlay */
.modal-backdrop,
.modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: var(--kf-modal-backdrop);
    backdrop-filter: blur(8px);
    z-index: var(--kf-z-modal);
    opacity: 0;
    visibility: hidden;
    transition: all var(--kf-duration-normal) var(--kf-ease-out);
    
    /* Active state */
    &.active {
        opacity: 1;
        visibility: visible;
    }
}

/* Modal container */
.modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: var(--kf-z-modal);
    display: flex;
    align-items: center;
    justify-content: center;
    padding: var(--kf-space-6);
    opacity: 0;
    visibility: hidden;
    transition: all var(--kf-duration-normal) var(--kf-ease-out);
    
    /* Active state */
    &.active {
        opacity: 1;
        visibility: visible;
        
        .modal-content {
            transform: translate(-50%, -50%) scale(1);
            opacity: 1;
        }
    }
    
    /* Prevent body scroll when modal is open */
    &.active ~ body,
    &.active body {
        overflow: hidden;
    }
}

/* Modal content wrapper */
.modal-content {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%) scale(0.9);
    width: 100%;
    max-width: 600px;
    max-height: 90vh;
    background: var(--kf-dark-2);
    border: 1px solid var(--kf-border-default);
    border-radius: var(--kf-modal-radius);
    box-shadow: var(--kf-shadow-strong);
    overflow-y: auto;
    opacity: 0;
    transition: all var(--kf-duration-normal) var(--kf-ease-emphasized-decelerate);
}

/* Modal header */
.modal-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: var(--kf-space-6) var(--kf-space-6) var(--kf-space-4);
    border-bottom: 1px solid var(--kf-border-subtle);
    
    .modal-title {
        margin: 0;
        font-size: var(--kf-text-xl);
        font-weight: var(--kf-weight-medium);
        color: var(--kf-text-primary);
        letter-spacing: var(--kf-tracking-wide);
    }
}

/* Modal body */
.modal-body {
    padding: var(--kf-modal-padding);
    color: var(--kf-text-secondary);
    line-height: var(--kf-leading-relaxed);
}

/* Modal footer */
.modal-footer {
    display: flex;
    align-items: center;
    justify-content: flex-end;
    gap: var(--kf-space-3);
    padding: var(--kf-space-4) var(--kf-space-6) var(--kf-space-6);
    border-top: 1px solid var(--kf-border-subtle);
}

/* Modal close button */
.modal-close {
    position: absolute;
    top: var(--kf-space-4);
    right: var(--kf-space-4);
    width: 40px;
    height: 40px;
    background: var(--kf-overlay-medium);
    border: 1px solid var(--kf-border-default);
    border-radius: var(--kf-radius-full);
    color: var(--kf-text-secondary);
    font-size: var(--kf-text-xl);
    line-height: 1;
    cursor: pointer;
    z-index: var(--kf-z-popover);
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all var(--kf-duration-fast) var(--kf-ease-out);
    
    &:hover {
        background: var(--kf-overlay-strong);
        border-color: var(--kf-border-strong);
        color: var(--kf-text-primary);
        transform: scale(1.05);
    }
    
    &:active {
        transform: scale(0.95);
    }
}

/* === MODAL VARIANTS === */

/* Product detail modal */
.product-modal {
    .modal-content {
        max-width: 900px;
        max-height: 95vh;
    }
    
    .modal-body {
        padding: 0;
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 0;
    }
    
    .modal-images {
        background: var(--kf-black);
        border-right: 1px solid var(--kf-border-subtle);
        
        .image-main {
            aspect-ratio: 1;
            overflow: hidden;
            
            img {
                width: 100%;
                height: 100%;
                object-fit: cover;
            }
        }
        
        .image-thumbs {
            display: flex;
            gap: var(--kf-space-2);
            padding: var(--kf-space-4);
            overflow-x: auto;
            
            .thumb {
                flex-shrink: 0;
                width: 60px;
                height: 60px;
                border-radius: var(--kf-radius-default);
                border: 2px solid transparent;
                overflow: hidden;
                cursor: pointer;
                transition: border-color var(--kf-duration-fast) var(--kf-ease-out);
                
                &.active,
                &:hover {
                    border-color: var(--kf-text-primary);
                }
                
                img {
                    width: 100%;
                    height: 100%;
                    object-fit: cover;
                }
            }
        }
    }
    
    .modal-details {
        padding: var(--kf-space-8);
        
        .modal-title {
            font-size: var(--kf-text-2xl);
            margin-bottom: var(--kf-space-4);
            letter-spacing: var(--kf-tracking-wider);
        }
        
        .modal-price {
            font-size: var(--kf-text-xl);
            font-weight: var(--kf-weight-medium);
            color: var(--kf-accent-green);
            margin-bottom: var(--kf-space-4);
        }
        
        .modal-material {
            color: var(--kf-text-muted);
            margin-bottom: var(--kf-space-6);
        }
        
        .modal-description {
            margin-bottom: var(--kf-space-8);
            line-height: var(--kf-leading-relaxed);
        }
        
        .modal-sizes {
            margin-bottom: var(--kf-space-8);
            
            h4 {
                font-size: var(--kf-text-sm);
                color: var(--kf-text-muted);
                letter-spacing: var(--kf-tracking-widest);
                margin-bottom: var(--kf-space-4);
            }
            
            .size-options {
                display: flex;
                gap: var(--kf-space-2);
                flex-wrap: wrap;
                
                .size-btn {
                    padding: var(--kf-space-2) var(--kf-space-4);
                    background: transparent;
                    border: 1px solid var(--kf-border-default);
                    color: var(--kf-text-secondary);
                    border-radius: var(--kf-radius-default);
                    cursor: pointer;
                    transition: all var(--kf-duration-fast) var(--kf-ease-out);
                    
                    &:hover,
                    &.active {
                        border-color: var(--kf-text-primary);
                        color: var(--kf-text-primary);
                        background: var(--kf-overlay-light);
                    }
                }
            }
        }
    }
}

/* Blockchain block detail modal */
.block-modal {
    .modal-content {
        max-width: 700px;
    }
    
    .detail-header {
        display: grid;
        grid-template-columns: 1fr auto;
        gap: var(--kf-space-4);
        margin-bottom: var(--kf-space-6);
        padding-bottom: var(--kf-space-4);
        border-bottom: 1px solid var(--kf-border-subtle);
        
        .detail-header-left {
            display: flex;
            gap: var(--kf-space-3);
            align-items: center;
        }
        
        .detail-header-right {
            text-align: right;
            display: flex;
            flex-direction: column;
            gap: var(--kf-space-1);
        }
        
        .block-id-badge {
            background: rgba(0, 255, 0, 0.15);
            border: 1px solid var(--kf-accent-green);
            padding: var(--kf-space-1) var(--kf-space-3);
            border-radius: var(--kf-radius-full);
            font-size: var(--kf-text-xs);
            font-weight: var(--kf-weight-medium);
            color: var(--kf-accent-green);
            font-family: var(--kf-font-mono);
        }
        
        .transaction-type-badge {
            padding: var(--kf-space-1) var(--kf-space-2);
            border-radius: var(--kf-radius-default);
            font-size: var(--kf-text-xs);
            font-weight: var(--kf-weight-medium);
            text-transform: uppercase;
            letter-spacing: var(--kf-tracking-wide);
            
            &.mint {
                background: rgba(0, 150, 255, 0.15);
                color: var(--kf-accent-blue);
                border: 1px solid var(--kf-accent-blue);
            }
            
            &.transfer {
                background: rgba(0, 255, 0, 0.15);
                color: var(--kf-accent-green);
                border: 1px solid var(--kf-accent-green);
            }
        }
    }
    
    .detail-grid {
        display: grid;
        gap: var(--kf-space-6);
        
        .detail-section {
            .section-title {
                font-size: var(--kf-text-sm);
                color: var(--kf-text-muted);
                text-transform: uppercase;
                letter-spacing: var(--kf-tracking-wide);
                margin-bottom: var(--kf-space-2);
            }
            
            .section-content {
                color: var(--kf-text-primary);
                font-weight: var(--kf-weight-medium);
            }
        }
    }
}

/* Admin confirmation dialog */
.confirm-modal,
.admin-dialog {
    .modal-content {
        max-width: 480px;
        text-align: center;
    }
    
    .modal-body {
        padding: var(--kf-space-8) var(--kf-space-6);
        
        .dialog-icon {
            width: 48px;
            height: 48px;
            margin: 0 auto var(--kf-space-4);
            background: var(--kf-accent-yellow);
            border-radius: var(--kf-radius-full);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: var(--kf-text-xl);
            color: var(--kf-black);
        }
        
        .dialog-title {
            font-size: var(--kf-text-lg);
            font-weight: var(--kf-weight-medium);
            color: var(--kf-text-primary);
            margin-bottom: var(--kf-space-3);
        }
        
        .dialog-message {
            color: var(--kf-text-secondary);
            line-height: var(--kf-leading-relaxed);
            margin-bottom: var(--kf-space-6);
        }
        
        .dialog-actions {
            display: flex;
            gap: var(--kf-space-3);
            justify-content: center;
        }
    }
}

/* === RESPONSIVE DESIGN === */

@media (max-width: 768px) {
    .modal {
        padding: var(--kf-space-4);
        align-items: flex-start;
        padding-top: var(--kf-space-8);
    }
    
    .modal-content {
        position: relative;
        top: auto;
        left: auto;
        transform: none;
        max-height: calc(100vh - var(--kf-space-16));
        width: 100%;
        max-width: none;
    }
    
    .modal.active .modal-content {
        transform: none;
    }
    
    /* Product modal mobile layout */
    .product-modal {
        .modal-body {
            grid-template-columns: 1fr;
            grid-template-rows: auto 1fr;
        }
        
        .modal-images {
            border-right: none;
            border-bottom: 1px solid var(--kf-border-subtle);
            
            .image-main {
                aspect-ratio: 4/3;
            }
        }
        
        .modal-details {
            padding: var(--kf-space-6) var(--kf-space-4);
        }
    }
    
    /* Adjust close button for mobile */
    .modal-close {
        top: var(--kf-space-3);
        right: var(--kf-space-3);
        width: 44px;
        height: 44px;
        font-size: var(--kf-text-lg);
    }
    
    /* Block modal specific mobile optimizations */
    .block-modal {
        .modal {
            padding-top: var(--kf-space-12);
            align-items: flex-start;
        }
        
        .modal-content {
            margin-top: 0;
            max-height: calc(100vh - var(--kf-space-24));
            overflow-y: auto;
        }
        
        .detail-header {
            grid-template-columns: 1fr;
            gap: var(--kf-space-2);
            text-align: center;
            
            .detail-header-left {
                justify-content: center;
            }
            
            .detail-header-right {
                text-align: center;
            }
        }
        
        .detail-grid {
            gap: var(--kf-space-4);
        }
    }
    
    /* Mobile-optimized modal padding */
    .modal-header,
    .modal-footer {
        padding-left: var(--kf-space-4);
        padding-right: var(--kf-space-4);
    }
    
    .modal-body {
        padding: var(--kf-space-6) var(--kf-space-4);
    }
}

/* === DEVICE-SPECIFIC OPTIMIZATIONS === */

/* Samsung S24 Ultra modal positioning */
@media screen and (min-width: 360px) and (max-width: 430px) 
       and (min-height: 1040px) and (orientation: portrait) 
       and (-webkit-device-pixel-ratio: 4) {
    
    .modal {
        padding-top: max(env(safe-area-inset-top, 160px), 160px);
    }
    
    /* Block modal specific S24 Ultra optimizations */
    .block-modal .modal {
        padding-top: max(env(safe-area-inset-top, 100px), 100px);
    }
    
    .block-modal .modal-content {
        max-height: calc(100vh - max(env(safe-area-inset-top, 100px), 100px) - var(--kf-space-12));
    }
    
    .modal-close {
        top: max(env(safe-area-inset-top, 70px), 70px);
        right: var(--kf-space-4);
        z-index: calc(var(--kf-z-modal) + 1);
    }
    
    .modal-content {
        max-height: calc(100vh - max(env(safe-area-inset-top, 160px), 160px) - var(--kf-space-8));
    }
}

/* === ANIMATION VARIANTS === */

/* Slide up animation */
.modal-slide-up {
    .modal-content {
        transform: translate(-50%, 100%);
    }
    
    &.active .modal-content {
        transform: translate(-50%, -50%);
    }
}

/* Fade scale animation (default) */
.modal-fade-scale {
    .modal-content {
        transform: translate(-50%, -50%) scale(0.9);
        opacity: 0;
    }
    
    &.active .modal-content {
        transform: translate(-50%, -50%) scale(1);
        opacity: 1;
    }
}

/* Zoom animation */
.modal-zoom {
    .modal-content {
        transform: translate(-50%, -50%) scale(0.7);
        opacity: 0;
    }
    
    &.active .modal-content {
        transform: translate(-50%, -50%) scale(1);
        opacity: 1;
    }
}

/* === ACCESSIBILITY ENHANCEMENTS === */

/* High contrast mode support */
@media (prefers-contrast: high) {
    .modal-content {
        border-width: 2px;
        border-color: var(--kf-text-primary);
    }
    
    .modal-close {
        border-width: 2px;
    }
}

/* Reduced motion support */
@media (prefers-reduced-motion: reduce) {
    .modal,
    .modal-content,
    .modal-close {
        transition: none;
        animation: none;
    }
    
    .modal.active .modal-content {
        transform: translate(-50%, -50%);
    }
}

/* Focus trap for keyboard navigation */
.modal.active {
    /* Ensure modal content is focusable */
    .modal-content {
        outline: none;
    }
    
    /* Style focus indicators */
    .modal-content *:focus-visible {
        outline: 2px solid var(--kf-accent-blue);
        outline-offset: 2px;
    }
}

/* === MODAL BODY SCROLL PREVENTION === */

/* Prevent body scroll when modal is active */
body.modal-active,
html.modal-active {
    overflow: hidden;
    height: 100vh;
}

/* === UTILITY CLASSES === */

/* Modal state utilities */
.modal-hidden { display: none !important; }
.modal-visible { display: flex !important; }

/* Modal size utilities */
.modal-sm .modal-content { max-width: 400px; }
.modal-md .modal-content { max-width: 600px; }
.modal-lg .modal-content { max-width: 900px; }
.modal-xl .modal-content { max-width: 1200px; }
.modal-full .modal-content { max-width: 95vw; max-height: 95vh; }