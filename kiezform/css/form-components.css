/**
 * KiezForm Form Components
 * Version 1.0 - Unified form system using design tokens
 * 
 * Import design-tokens.css before this file.
 * Provides consistent, accessible, and mobile-friendly form components.
 */

/* === BASE FORM STYLES === */

/* Form container */
.form,
.form-container {
    width: 100%;
    max-width: var(--kf-container-md);
    margin: 0 auto;
}

/* Form groups for field organization */
.form-group,
.field-group {
    margin-bottom: var(--kf-space-6);
    
    &:last-child {
        margin-bottom: 0;
    }
}

/* Form labels */
.form-label,
label {
    display: block;
    margin-bottom: var(--kf-space-2);
    font-size: var(--kf-text-sm);
    font-weight: var(--kf-weight-medium);
    color: var(--kf-text-secondary);
    letter-spacing: var(--kf-tracking-wide);
    text-transform: uppercase;
    
    /* Required field indicator */
    &.required::after,
    &[required]::after {
        content: ' *';
        color: var(--kf-accent-red);
        font-weight: var(--kf-weight-bold);
    }
}

/* === INPUT STYLES === */

/* Base input styling */
input,
textarea,
select {
    width: 100%;
    min-height: var(--kf-input-height);
    padding: var(--kf-input-padding-y) var(--kf-input-padding-x);
    font-family: var(--kf-font-primary);
    font-size: var(--kf-text-base);
    font-weight: var(--kf-weight-regular);
    line-height: var(--kf-leading-normal);
    color: var(--kf-text-primary);
    background: var(--kf-overlay-light);
    border: 1px solid var(--kf-border-default);
    border-radius: var(--kf-radius-default);
    transition: all var(--kf-duration-fast) var(--kf-ease-out);
    outline: none;
    
    /* Placeholder styling */
    &::placeholder {
        color: var(--kf-text-muted);
        font-weight: var(--kf-weight-light);
    }
    
    /* Focus state */
    &:focus {
        border-color: var(--kf-accent-blue);
        background: var(--kf-overlay-medium);
        box-shadow: 0 0 0 3px rgba(0, 150, 255, 0.1);
    }
    
    /* Hover state */
    &:hover:not(:focus):not(:disabled) {
        border-color: var(--kf-border-strong);
        background: var(--kf-overlay-medium);
    }
    
    /* Disabled state */
    &:disabled {
        background: var(--kf-overlay-light);
        border-color: var(--kf-border-subtle);
        color: var(--kf-text-disabled);
        cursor: not-allowed;
        opacity: 0.6;
    }
    
    /* Error state */
    &.error,
    &:invalid:not(:placeholder-shown) {
        border-color: var(--kf-accent-red);
        background: rgba(220, 44, 63, 0.05);
        
        &:focus {
            box-shadow: 0 0 0 3px rgba(220, 44, 63, 0.1);
        }
    }
    
    /* Success state */
    &.success,
    &:valid:not(:placeholder-shown):not(:focus) {
        border-color: var(--kf-accent-green);
        background: rgba(0, 255, 0, 0.03);
    }
}

/* === INPUT VARIANTS === */

/* Text inputs */
input[type="text"],
input[type="email"],
input[type="password"],
input[type="url"],
input[type="tel"],
input[type="search"] {
    /* Base styling already applied above */
}

/* Number inputs */
input[type="number"] {
    /* Remove default number input arrows */
    -moz-appearance: textfield;
    
    &::-webkit-outer-spin-button,
    &::-webkit-inner-spin-button {
        -webkit-appearance: none;
        margin: 0;
    }
}

/* Date/time inputs */
input[type="date"],
input[type="datetime-local"],
input[type="time"] {
    /* Custom styling for date inputs */
    &::-webkit-calendar-picker-indicator {
        background: var(--kf-text-muted);
        border-radius: var(--kf-radius-sm);
        cursor: pointer;
        padding: var(--kf-space-1);
        
        &:hover {
            background: var(--kf-text-secondary);
        }
    }
}

/* Search inputs */
input[type="search"] {
    /* Remove default search styling */
    -webkit-appearance: none;
    
    &::-webkit-search-decoration,
    &::-webkit-search-cancel-button,
    &::-webkit-search-results-button,
    &::-webkit-search-results-decoration {
        -webkit-appearance: none;
    }
}

/* Password inputs */
input[type="password"] {
    font-family: var(--kf-font-mono);
    letter-spacing: 0.1em;
}

/* === TEXTAREA === */

textarea {
    min-height: 120px;
    resize: vertical;
    line-height: var(--kf-leading-relaxed);
    
    /* Prevent horizontal resize */
    resize: vertical;
    
    /* Improve mobile experience */
    &:focus {
        /* Prevent zoom on iOS */
        font-size: max(var(--kf-text-base), 16px);
    }
}

/* === SELECT DROPDOWNS === */

select {
    cursor: pointer;
    padding-right: calc(var(--kf-input-padding-x) + 24px);
    background-image: url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23808080' viewBox='0 0 16 16'%3E%3Cpath d='M8 11L3 6h10l-5 5z'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right var(--kf-input-padding-x) center;
    background-size: 16px;
    -webkit-appearance: none;
    -moz-appearance: none;
    appearance: none;
    
    &:focus {
        background-image: url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%230096ff' viewBox='0 0 16 16'%3E%3Cpath d='M8 11L3 6h10l-5 5z'/%3E%3C/svg%3E");
    }
    
    /* Multiple select */
    &[multiple] {
        background-image: none;
        padding-right: var(--kf-input-padding-x);
        min-height: 120px;
    }
}

/* === CHECKBOX & RADIO === */

/* Custom checkbox and radio styling */
input[type="checkbox"],
input[type="radio"] {
    width: 20px;
    height: 20px;
    min-height: auto;
    margin: 0 var(--kf-space-3) 0 0;
    padding: 0;
    -webkit-appearance: none;
    -moz-appearance: none;
    appearance: none;
    background: var(--kf-overlay-light);
    border: 2px solid var(--kf-border-default);
    cursor: pointer;
    position: relative;
    flex-shrink: 0;
    
    /* Focus state */
    &:focus {
        border-color: var(--kf-accent-blue);
        box-shadow: 0 0 0 2px rgba(0, 150, 255, 0.2);
    }
    
    /* Checked state */
    &:checked {
        background: var(--kf-accent-blue);
        border-color: var(--kf-accent-blue);
        
        /* Checkmark for checkbox */
        &[type="checkbox"]::after {
            content: '';
            position: absolute;
            top: 2px;
            left: 6px;
            width: 4px;
            height: 8px;
            border: solid var(--kf-white);
            border-width: 0 2px 2px 0;
            transform: rotate(45deg);
        }
        
        /* Dot for radio */
        &[type="radio"]::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 8px;
            height: 8px;
            background: var(--kf-white);
            border-radius: var(--kf-radius-full);
            transform: translate(-50%, -50%);
        }
    }
    
    /* Disabled state */
    &:disabled {
        background: var(--kf-overlay-light);
        border-color: var(--kf-border-subtle);
        cursor: not-allowed;
        
        &:checked {
            background: var(--kf-gray);
            border-color: var(--kf-gray);
        }
    }
}

/* Checkbox specific styling */
input[type="checkbox"] {
    border-radius: var(--kf-radius-sm);
}

/* Radio specific styling */
input[type="radio"] {
    border-radius: var(--kf-radius-full);
}

/* === FORM FIELD LAYOUTS === */

/* Checkbox and radio labels */
.form-check,
.checkbox-group,
.radio-group {
    display: flex;
    align-items: flex-start;
    gap: var(--kf-space-3);
    margin-bottom: var(--kf-space-4);
    
    label {
        margin-bottom: 0;
        cursor: pointer;
        text-transform: none;
        font-weight: var(--kf-weight-regular);
        line-height: var(--kf-leading-relaxed);
    }
    
    input[type="checkbox"],
    input[type="radio"] {
        margin: 0.2em 0 0 0;
    }
}

/* Inline form fields */
.form-inline {
    display: flex;
    gap: var(--kf-space-4);
    align-items: end;
    
    .form-group {
        margin-bottom: 0;
        flex: 1;
    }
    
    button {
        flex-shrink: 0;
    }
}

/* Input groups (with icons or buttons) */
.input-group {
    position: relative;
    display: flex;
    width: 100%;
    
    input {
        flex: 1;
        min-width: 0;
    }
    
    /* Input with left icon */
    &.has-icon-left {
        input {
            padding-left: calc(var(--kf-input-padding-x) + 32px);
        }
        
        .input-icon-left {
            position: absolute;
            left: var(--kf-input-padding-x);
            top: 50%;
            transform: translateY(-50%);
            width: 20px;
            height: 20px;
            color: var(--kf-text-muted);
            z-index: var(--kf-z-elevated);
            pointer-events: none;
        }
    }
    
    /* Input with right icon */
    &.has-icon-right {
        input {
            padding-right: calc(var(--kf-input-padding-x) + 32px);
        }
        
        .input-icon-right {
            position: absolute;
            right: var(--kf-input-padding-x);
            top: 50%;
            transform: translateY(-50%);
            width: 20px;
            height: 20px;
            color: var(--kf-text-muted);
            z-index: var(--kf-z-elevated);
            pointer-events: none;
        }
    }
    
    /* Input with button */
    .input-btn {
        margin-left: -1px;
        border-top-left-radius: 0;
        border-bottom-left-radius: 0;
    }
    
    input + .input-btn {
        border-top-right-radius: 0;
        border-bottom-right-radius: 0;
    }
}

/* === FORM VALIDATION === */

/* Error messages */
.form-error,
.error-message {
    display: block;
    margin-top: var(--kf-space-2);
    font-size: var(--kf-text-sm);
    color: var(--kf-accent-red);
    line-height: var(--kf-leading-normal);
}

/* Success messages */
.form-success,
.success-message {
    display: block;
    margin-top: var(--kf-space-2);
    font-size: var(--kf-text-sm);
    color: var(--kf-accent-green);
    line-height: var(--kf-leading-normal);
}

/* Help text */
.form-help,
.help-text {
    display: block;
    margin-top: var(--kf-space-2);
    font-size: var(--kf-text-sm);
    color: var(--kf-text-muted);
    line-height: var(--kf-leading-normal);
}

/* === SPECIAL INPUT TYPES === */

/* File inputs */
input[type="file"] {
    padding: var(--kf-space-3);
    border: 2px dashed var(--kf-border-default);
    background: var(--kf-overlay-light);
    cursor: pointer;
    text-align: center;
    
    &:hover {
        border-color: var(--kf-border-strong);
        background: var(--kf-overlay-medium);
    }
    
    &:focus {
        border-color: var(--kf-accent-blue);
        border-style: solid;
    }
}

/* Range inputs */
input[type="range"] {
    height: 24px;
    background: transparent;
    border: none;
    padding: 0;
    cursor: pointer;
    
    /* Track styling */
    &::-webkit-slider-track {
        width: 100%;
        height: 4px;
        background: var(--kf-border-default);
        border-radius: var(--kf-radius-full);
    }
    
    &::-moz-range-track {
        width: 100%;
        height: 4px;
        background: var(--kf-border-default);
        border-radius: var(--kf-radius-full);
        border: none;
    }
    
    /* Thumb styling */
    &::-webkit-slider-thumb {
        -webkit-appearance: none;
        height: 20px;
        width: 20px;
        background: var(--kf-accent-blue);
        border-radius: var(--kf-radius-full);
        cursor: pointer;
        margin-top: -8px;
        transition: all var(--kf-duration-fast) var(--kf-ease-out);
        
        &:hover {
            transform: scale(1.1);
            box-shadow: 0 2px 8px rgba(0, 150, 255, 0.3);
        }
    }
    
    &::-moz-range-thumb {
        height: 20px;
        width: 20px;
        background: var(--kf-accent-blue);
        border-radius: var(--kf-radius-full);
        cursor: pointer;
        border: none;
        transition: all var(--kf-duration-fast) var(--kf-ease-out);
        
        &:hover {
            transform: scale(1.1);
            box-shadow: 0 2px 8px rgba(0, 150, 255, 0.3);
        }
    }
}

/* === RESPONSIVE DESIGN === */

@media (max-width: 768px) {
    /* Mobile-optimized input sizing */
    input,
    textarea,
    select {
        min-height: var(--kf-button-height);
        font-size: max(var(--kf-text-base), 16px); /* Prevent zoom on iOS */
        padding: var(--kf-space-3) var(--kf-space-4);
    }
    
    /* Stack inline forms on mobile */
    .form-inline {
        flex-direction: column;
        align-items: stretch;
        
        .form-group {
            margin-bottom: var(--kf-space-4);
        }
        
        .form-group:last-child {
            margin-bottom: 0;
        }
    }
    
    /* Mobile checkbox/radio spacing */
    .form-check,
    .checkbox-group,
    .radio-group {
        align-items: center;
        
        input[type="checkbox"],
        input[type="radio"] {
            width: 24px;
            height: 24px;
            margin: 0 var(--kf-space-3) 0 0;
        }
    }
}

/* === ACCESSIBILITY ENHANCEMENTS === */

/* High contrast mode support */
@media (prefers-contrast: high) {
    input,
    textarea,
    select {
        border-width: 2px;
    }
    
    input[type="checkbox"],
    input[type="radio"] {
        border-width: 3px;
    }
}

/* Reduced motion support */
@media (prefers-reduced-motion: reduce) {
    input,
    textarea,
    select,
    input[type="checkbox"],
    input[type="radio"],
    input[type="range"]::-webkit-slider-thumb,
    input[type="range"]::-moz-range-thumb {
        transition: none;
    }
}

/* Focus visible for keyboard users */
input:focus-visible,
textarea:focus-visible,
select:focus-visible {
    outline: 2px solid var(--kf-accent-blue);
    outline-offset: 2px;
}

/* === FORM LOADING STATES === */

.form-loading {
    position: relative;
    pointer-events: none;
    
    &::after {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: var(--kf-overlay-backdrop);
        backdrop-filter: blur(2px);
        z-index: var(--kf-z-overlay);
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    &::before {
        content: '';
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 32px;
        height: 32px;
        border: 3px solid var(--kf-border-default);
        border-top-color: var(--kf-accent-blue);
        border-radius: var(--kf-radius-full);
        animation: form-spin 1s linear infinite;
        z-index: calc(var(--kf-z-overlay) + 1);
    }
}

@keyframes form-spin {
    from {
        transform: translate(-50%, -50%) rotate(0deg);
    }
    to {
        transform: translate(-50%, -50%) rotate(360deg);
    }
}

/* === UTILITY CLASSES === */

/* Form spacing utilities */
.form-tight .form-group { margin-bottom: var(--kf-space-4); }
.form-loose .form-group { margin-bottom: var(--kf-space-8); }

/* Form alignment utilities */
.form-center { text-align: center; }
.form-right { text-align: right; }

/* Required field styling */
.required {
    color: var(--kf-accent-red);
    font-weight: var(--kf-weight-semibold);
}

/* Read-only styling */
.readonly,
input[readonly],
textarea[readonly] {
    background: var(--kf-overlay-light);
    border-color: var(--kf-border-subtle);
    color: var(--kf-text-muted);
    cursor: default;
}

/* Hidden inputs */
.visually-hidden {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border: 0;
}